# Prompt: Backend - Security Audit & Storage Setup

**Context:**
The database schema is mostly in place, but Row Level Security (RLS) needs to be verified to ensure data isolation between different schools (multi-tenancy). Storage buckets also need to be configured.

**Task:**
1.  **RLS Audit:**
    *   Review existing migrations in `supabase/migrations`.
    *   Create a new migration (e.g., `20260122000009_fix_rls.sql`) to ensure RLS is ENABLED on all tables: `profiles`, `schedules`, `devices`, `audio_files`, `device_commands` (if it exists).
    *   Add policies that restrict access based on `school_id`.
        *   *Assumption:* Users have a `school_id` in their `auth.users` metadata or a `public.users` profile table.
        *   Policy example: `auth.uid() = user_id` OR `school_id = (select school_id from public.users where id = auth.uid())`.
    *   Ensure the "Anon" role cannot read sensitive data (or any data, depending on the requirement).

2.  **Storage Configuration:**
    *   Verify the `audio_files` bucket exists in the migrations (or create it via SQL: `insert into storage.buckets ...`).
    *   Add RLS policies for the `storage.objects` table to allow authenticated users to upload/read files in the `audio_files` bucket, restricted by their `school_id` folder convention if applicable, or just generally authenticated users for now.

**References:**
*   `supabase/migrations`
*   `status1.md` (Section 3 - Backend & Infrastructure)

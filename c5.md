# Prompt: IoT Firmware - Polling & Sync Logic

**Context:**
The firmware has basic structures for `pollCommands` and `syncSchedules`, but they need to be robust and tested against the actual JSON format returned by Supabase.

**Task:**
1.  **Command Polling (`pollCommands`):**
    *   Refine the HTTP GET request to check for pending commands for this device (e.g., from a `device_commands` table via Supabase REST API).
    *   Parse the JSON response. If a command (e.g., "reboot", "manual_ring") is found, execute it.
    *   Mark the command as "executed" (send a PATCH/POST back to Supabase) so it doesn't run again.

2.  **Schedule Sync (`syncSchedules`):**
    *   Fetch the active schedule for the device's assigned profile.
    *   Parse the JSON schedule array (Time, Ring Type, Audio File).
    *   Save this schedule to a local file (e.g., `/schedule.json` in LittleFS) for offline operation.
    *   Ensure the logic handles empty schedules or network errors gracefully (keep using the old schedule if sync fails).

3.  **JSON Handling:**
    *   Ensure the `ArduinoJson` library usage matches the data structure from the database.

**References:**
*   `esp32-firmware/src/main.cpp`
*   `status1.md` (Section 4 - IoT Firmware)
